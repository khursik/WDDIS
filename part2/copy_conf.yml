---
- name: Copy configuration files
  hosts: all
  gather_facts: no
  become: yes
  tasks:
    - name: nginx config file
      template: src=./config/nginx.conf dest=/etc/nginx/sites-enabled/{{ domain }}.conf
      register: nginx_config

    - name: uwsgi config file
      template: src=./config/uwsgi.ini dest=/etc/uwsgi/apps-enabled/{{ flask_project }}.ini
      register: uwsgi_config

    - name: nginx restart
      service: name=nginx state=restarted
      when: nginx_config.changed

    - name: uwsgi restart
      service: name=uwsgi state=restarted
      when: uwsgi_config.changed